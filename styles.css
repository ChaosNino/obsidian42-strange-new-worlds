body {
  --snw-counter-opacity: 0.4;
  --snw-icon-opacity: 0.4;
}


div:has(> .snw-reference),
.snw-link-preview {
  display: inline;
}

/* ==========================================================
   SNW 角标样式分层处理
   目标：正文保留原作者样式，面板使用修复版样式
   ========================================================== */

/* 1. 全局默认样式（应用原作者的原始代码） */
/* 适用于：正文阅读视图、实时预览 */
.snw-reference {
  display: inline; /* 关键：原作者使用 inline，自适应宽度，不会变长条 */
  font-size: var(--font-ui-smaller);
  border-radius: var(--radius-s);
  border: var(--border-width) dotted;
  vertical-align: top;
  opacity: var(--snw-counter-opacity);
  min-width: 10px;
  padding-left: 3px;
  padding-right: 3px !important;
  margin-left: 3px !important;
  margin-right: 2px;
}

/* 2. 面板专用样式（应用我们的修复补丁） */
/* 适用于：悬浮窗 (Popover) 和 侧边栏 (Sidepane) */
.snw-popover-container .snw-reference,
.snw-sidepane-container .snw-reference {
  display: inline-block !important;
  
  /* --- 1. 大小调整区 --- */
  /* 默认是 inherit (继承)，改成 0.6em 或 10px 即可变小 */
  font-size: 0.8em !important; 

  /* --- 2. 位置调整区 (靠上一些) --- */
  vertical-align: middle !important; /* 保持这个基准，防止撑开列表行距 */
  position: relative !important;     /* 开启相对定位，允许微调 */
  top: -2px !important;              /* 关键：负数向上移，正数向下移。如果不满意，改这个数字！ */

  /* --- 3. 盒子形状 --- */
  min-width: 1.4em !important;
  height: 1.4em !important;
  
  /* --- 4. 数字在盒子内居中 --- */
  text-align: center !important;
  line-height: 1.2em !important;     /* 稍微小于 height，视觉上更居中 */
  
  /* --- 5. 其他防干扰设置 --- */
  text-indent: 0 !important;
  white-space: nowrap !important;
  padding: 0 !important;
  margin: 0 2px !important;
}

/* ==========================================================
   SNW 终极补丁：修复悬浮窗列表间距 & 链接颜色
   (请保留文件末尾的这段代码，如果之前没加，请补上)
   ========================================================== */

.snw-popover-container ul, .snw-popover-container ol,
.snw-sidepane-container ul, .snw-sidepane-container ol {
  margin-block: 0.25em !important;
  padding-inline-start: 1.2em !important;
}

.snw-popover-container li,
.snw-sidepane-container li {
  margin-block: 0 !important;
  padding-block: 0 !important;
  line-height: 1.4 !important;
}

/* 修复链接颜色 */
.snw-popover-container a,
.snw-sidepane-container a {
  color: var(--link-color) !important;
  text-decoration: var(--link-decoration) !important;
}

.snw-popover-container a:hover,
.snw-sidepane-container a:hover {
  color: var(--link-color-hover) !important;
  text-decoration: var(--link-decoration-hover) !important;
}

.is-mobile .snw-reference {
  font-size: var(--font-ui-smaller);
}

/* Properties */
/* Have to remove the underline since text-decoration-line isn't inheritted, but then re-add ito the link */
.metadata-container .internal-link:has(.snw-frontmatter-wrapper) {
  text-decoration-line: none !important;
  color: unset;
  cursor: unset;

  .multi-select-pill-content {
    text-decoration-line: underline !important;
    color: var(--link-color);
    cursor: var(--cursor-link);
  }
}

/* custom properties display */
.snw-custom-property-name {
  font-style: italic;
}

/* CM Live Preview */
.cm-content .snw-reference {
  padding-right: 2px;
}

/* Preview mode */
.markdown-preview-view .snw-reference {
  padding-right: 3px;
}

.snw-block {
  padding-left: 2px;
  margin-left: 2px;
}

.snw-heading {
  margin-left: 2px;
  font-size: var(--font-ui-smaller);
}

.snw-embed {
  margin-top: 1px;
}

.snw-embed-preview {
  top: 2px;
}

.snw-link {
  margin-left: 3px;
}

/* Hover container */
.snw-popover-container {
  border-radius: var(--radius-l);
  border: var(--border-width) solid var(--modal-border-color);
  box-shadow: var(--shadow-s);
  background-color: var(--background-primary) !important;
  min-height: 100px;
  width: 300px;
  overflow: hidden;
  z-index: 1000;
}

/* Shared reference area CSS */

.snw-ref-area {
  display: flex;
  flex-direction: column;
  overflow-y: scroll;
  max-height: 300px !important;
  color: var(--text-normal);
}

.snw-sidepane-container>div>.snw-ref-area {
  max-height: 100% !important;
  margin-bottom: 10px;
}

.snw-ref-area::-webkit-scrollbar {
  display: none;
}

.snw-ref-title-popover {
  color: var(--text-normal);
  padding-top: 5px;
  padding-left: 10px;
  padding-right: 5px;
  padding-bottom: 10px;
  margin-bottom: 10px;
  border-bottom: var(--border-width) solid var(--modal-border-color);
  display: flex;
  flex-direction: row;
  align-items: center;
}

.snw-ref-title-popover-open-sidepane-icon {
  width: 25px;
  opacity: var(--snw-icon-opacity);
}

.snw-ref-title-popover-label {
  width: 100%;
}

.snw-ref-title-side-pane {
  color: var(--tab-text-color-active);
  padding-top: 5px;
  padding-left: 10px;
  padding-right: 5px;
  padding-bottom: 5px;
  margin-bottom: 5px;
  border-radius: var(--radius-s);
  background-color: var(--titlebar-background-focused);
  border: var(--border-width) solid var(--modal-border-color);
  align-items: center;
}

.snw-ref-item-container {
  margin-bottom: 10px;
}

.snw-ref-item-file {
  display: flex;
  flex-direction: row;
}

.snw-ref-item-file.tree-item-self {
  align-items: flex-start !important;
}

.snw-ref-item-collection-items {
  margin-left: 1px;
  margin-right: 1px;
  margin-bottom: 1px !important;
}

[uic='uic']>* {
  margin-top: 0px !important;
  margin-bottom: 0px !important;
  max-height: 230px !important;
  overflow: hidden;
  white-space: normal;
}

.snw-ref-item-info a {
  text-decoration: none;
  color: var(--text-normal) !important;
  cursor: default;
}

/* Sidepane */

.snw-sidepane-container {
  height: 100%;
}

.snw-header-count-wrapper {
  position: absolute;
  border: var(--border-width) dotted;
  font-size: var(--font-ui-smallest);
  border-radius: var(--radius-s);
  min-width: 18px;
  min-height: 18px;
  right: 20px;
  opacity: var(--snw-counter-opacity);
  padding: 3px;
  z-index: 1000;
}

/* Modification for when Edting Toolbar plugin is used */
.view-content:has(.top.cMenuToolbarDefaultAesthetic),
.view-content:has(.top.cMenuToolbarTinyAesthetic) {
  .snw-header-count-wrapper {
    top: 80px;
  }
}

.view-content:has(.top.cMenuToolbarGlassAesthetic) {
  .snw-header-count-wrapper {
    top: 70px;
  }
}

.snw-header-count {
  text-align: center;
}

.snw-sidepane-container {
  padding: 10px;
  overflow: scroll;
}

.snw-sidepane-header {
  font-weight: bold;
  padding-top: 5px;
  padding-bottom: 5px;
}

.snw-sidepane-header-references-header {
  font-weight: bold;
  padding-top: 15px;
  padding-bottom: 5px;
}

.snw-sidepane-references {
  margin-top: 0px;
  padding-left: 20px;
}

.snw-sidepane-reference-item {
  padding-bottom: 5px;
  line-height: normal;
}

.snw-sidepane-loading {
  color: var(--text-muted);
  margin-top: 15px;
  margin-left: 20px;
}

.snw-sidepane-loading-subtext {
  color: var(--text-faint);
  font-style: italic;
  margin-top: 10px;
  font-size: small;
}

.snw-gutter-ref {
  /* margin-right: 6px; */
}

.cm-gutters {
  z-index: 0 !important;
}

.snw-breadcrumbs {
  display: flex;
  align-items: baseline;
  border-bottom: 1px solid var(--background-modifier-border);
}

.snw-breadcrumbs>span {
  margin-right: 1ch;
  border: 1px solid var(--background-modifier-border);
  border-radius: var(--radius-s);
  font-weight: bold;
  padding-left: 3px;
  padding-right: 3px;
}

/* .tippy-box settings to avoid conflicts with other plugins */
.snw-tippy .tippy-box {
  background-color: transparent;
}

.snw-tippy .tippy-content {
  padding: 0px;
}

.snw-tippy .tippy-arrow {
  width: 0px;
  height: 0px;
  color: transparent;
}

/* Dropdown options */
.snw-sort-dropdown-wrapper {
  position: relative;
}

.snw-sort-dropdown-button {
  border: none !important;
  box-shadow: none !important;
  width: 35px;
  background-color: unset !important;
  opacity: var(--snw-icon-opacity);

  >svg {
    width: 25px;
    color: var(--tab-text-color-focused) !important;
  }
}

.snw-sort-dropdown-list {
  position: absolute;
  right: 0;
  top: 15px;
  width: 90px;
  padding: 5px;
  z-index: 1;
  border: 3px solid var(--divider-color);
  border-radius: 2px;
  background-color: var(--background-primary);
  overflow-y: auto;
  list-style: none;
  color: var(--nav-item-color);
  font-size: var(--nav-item-size);
  font-weight: var(--nav-item-weight);
}

.snw-sort-dropdown-list-item {
  padding-left: 5px;
}

.snw-sort-dropdown-list-item:hover {
  background-color: var(--background-modifier-hover);
}

.snw-sort-dropdown-list-item-label {
  padding-left: 5px;
  position: relative;
  bottom: 5px;
}


/* prevent printing of reference numbers */
@media print {
  .snw-reference {
    display: none;
  }
}

/* ==========================================================
   SNW 字体大小修复补丁
   同时修复悬浮窗 (.snw-popover-container) 和侧边栏 (.snw-sidepane-container)
   ========================================================== */

.snw-popover-container,
.snw-sidepane-container {
  /* 1. 核心修复：重置 Obsidian 用于正文渲染的全局变量 */
  /* 让所有子元素（包括 Callout）计算大小时，都基于这个较小的变量 */
  --font-text-size: var(--font-ui-smaller) !important;
  
  /* 2. 可选：缩小段落间距，使其在小窗口看起来更紧凑 */
  --p-spacing: 0.5em !important;
}

/* 3. 强制覆盖所有 Markdown 渲染内容的字体大小 */
/* 包括：引用块、Callout、列表、段落、标题 */
.snw-popover-container .markdown-rendered *,
.snw-sidepane-container .markdown-rendered *,
.snw-popover-container .callout,
.snw-sidepane-container .callout {
  font-size: var(--font-ui-smaller) !important;
  line-height: 1.4 !important; /* 防止行高过大 */
}

/* 4. 特殊处理：修复 Callout 内部的边距，防止在大纲视图中太占地方 */
.snw-popover-container .callout,
.snw-sidepane-container .callout {
  margin: 4px 0 !important;
  padding: 8px !important;
}

/* 5. 确保侧边栏的标题也是小字体 */
.snw-sidepane-container .snw-ref-item-file-label {
  font-size: var(--font-ui-smaller) !important;
}

/* ==========================================================
   SNW 终极补丁：修复悬浮窗列表间距 & 链接颜色
   ========================================================== */

/* 1. 修复悬浮窗/侧边栏中的列表间距过大问题 */
.snw-popover-container ul, .snw-popover-container ol,
.snw-sidepane-container ul, .snw-sidepane-container ol {
  margin-block: 0.25em !important;
  padding-inline-start: 1.2em !important;
}

.snw-popover-container li,
.snw-sidepane-container li {
  margin-block: 0 !important;
  padding-block: 0 !important;
  line-height: 1.4 !important; /* 紧凑行高 */
}

/* 2. 修复悬浮窗中链接颜色不跟随主题的问题 */
.snw-popover-container a,
.snw-sidepane-container a {
  color: var(--link-color) !important;
  text-decoration: var(--link-decoration) !important;
}

.snw-popover-container a:hover,
.snw-sidepane-container a:hover {
  color: var(--link-color-hover) !important;
  text-decoration: var(--link-decoration-hover) !important;
}

/* ==========================================================
   SNW 颜色修复：区分“原文高亮”与“搜索命中”
   ========================================================== */

/* 1. 恢复原笔记的高亮颜色 (==高亮==) */
/* 强制使用当前主题定义的默认高亮背景色 */
.snw-popover-container mark,
.snw-sidepane-container mark {
  background-color: var(--text-highlight-bg) !important;
  color: var(--text-normal) !important;
}

/* 2. 自定义 SNW 命中关键词的颜色 */
/* 将搜索结果的匹配文字改为指定的 #ebcb8b (淡黄色) */
.snw-popover-container .search-result-file-matched-text,
.snw-sidepane-container .search-result-file-matched-text {
  background-color: #ebcb8b !important;
  color: var(--text-normal) !important; /* 保持文字颜色清晰 */
  
  /* 可选：如果你希望命中词不要也是 mark 标签的样式，可以重置它 */
  border-radius: 0 !important;
  padding: 0 !important;
}

/* 3. 修复潜在的冲突：如果命中词本身就在高亮内 */
/* 确保命中词的颜色覆盖高亮颜色，或者反之（通常命中词优先级更高） */
.snw-popover-container mark .search-result-file-matched-text,
.snw-sidepane-container mark .search-result-file-matched-text {
  background-color: #ebcb8b !important;
}
